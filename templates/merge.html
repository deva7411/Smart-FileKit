<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>PDF Merger App</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Bootstrap & Google Fonts -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@500&display=swap" rel="stylesheet">

  <style>
    body {
      font-family: 'Quicksand', sans-serif;
      background: linear-gradient(to right, #fdfbfb, #ebedee);
    }

    nav {
      background-color: #6c5ce7;
    }

    nav .navbar-brand {
      color: white;
      font-weight: bold;
    }

    .hero-section {
      margin-top: 60px;
      animation: fadeInUp 1s ease-out;
    }

    .card {
      border: none;
      border-radius: 16px;
      background: white;
      box-shadow: 0 12px 25px rgba(0,0,0,0.1);
    }

    .dropzone {
      border: 2px dashed #6c5ce7;
      padding: 30px;
      text-align: center;
      cursor: pointer;
      border-radius: 10px;
      transition: background-color 0.3s;
    }

    .dropzone.dragover {
      background-color: #f1f1ff;
    }

    .progress {
      height: 10px;
      display: none;
    }

    #fileList {
      font-size: 0.9rem;
      margin-top: 10px;
      color: #555;
    }

    @keyframes fadeInUp {
      from { opacity: 0; transform: translateY(30px); }
      to { opacity: 1; transform: translateY(0); }
    }

    footer {
      margin-top: 40vh;
      padding: 20px;
      background: #6c5ce7;
      color: white;
      text-align: center;
    }

    .toast-container {
      position: fixed;
      top: 1rem;
      right: 1rem;
      z-index: 9999;
    }
  </style>
</head>
<body>

<!-- Navbar -->
<nav class="navbar navbar-expand-lg navbar-dark bg-primary shadow-sm">
  <div class="container">
    <a class="navbar-brand" href="/">📁 Smart Filekit</a>
    <a class="btn btn-light ms-auto" href="/">🏠 Home</a>
  </div>
</nav>

<!-- Main -->
<div class="container hero-section">
  <div class="row justify-content-center">
    <div class="col-md-6">

      <div class="card p-4">
        <h3 class="text-center text-primary mb-3">📎 Merge Your PDFs</h3>
        <p class="text-center text-muted mb-3">
          Upload <strong>2 or more</strong> PDFs, each less than <strong>1MB</strong>.
        </p>

        <form id="uploadForm" method="POST" action="/merge" enctype="multipart/form-data">
          <div class="dropzone" id="dropzone">
            Drag & Drop PDF files here or click to select
            <input type="file" id="pdfs" name="pdfs" accept=".pdf" multiple hidden required>
            <div id="fileList"></div>
          </div>

          <div class="progress mt-3">
            <div class="progress-bar progress-bar-striped progress-bar-animated bg-success" style="width: 0%"></div>
          </div>

          <div class="d-grid mt-4">
            <button type="submit" class="btn btn-success btn-lg rounded-pill">🚀 Merge PDFs</button>
          </div>
        </form>
      </div>

    </div>
  </div>
</div>

<!-- Toast container -->
<div class="toast-container" id="toastContainer"></div>

<!-- Footer -->
<footer>
  <p>© 2025 PDF Merger | Built with 💖 using Flask & Bootstrap</p>
</footer>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<script>
  const dropzone = document.getElementById("dropzone");
  const input = document.getElementById("pdfs");
  const form = document.getElementById("uploadForm");
  const progressBar = document.querySelector(".progress-bar");
  const progressWrapper = document.querySelector(".progress");
  const fileListDiv = document.getElementById("fileList");

  // 🔹 Drag-and-drop
  dropzone.addEventListener("click", () => input.click());
  dropzone.addEventListener("dragover", (e) => {
    e.preventDefault();
    dropzone.classList.add("dragover");
  });
  dropzone.addEventListener("dragleave", () => dropzone.classList.remove("dragover"));
  dropzone.addEventListener("drop", (e) => {
    e.preventDefault();
    dropzone.classList.remove("dragover");
    input.files = e.dataTransfer.files;
    updateFileList(input.files);
  });

  // 🔹 Show selected file names
  input.addEventListener("change", () => {
    updateFileList(input.files);
  });

  function updateFileList(files) {
    if (files.length === 0) {
      fileListDiv.innerHTML = "";
      return;
    }

    const names = Array.from(files).map(file => "📄 " + file.name);
    fileListDiv.innerHTML = names.join("<br>");
  }

  // 🔹 Toast function
  function showToast(message, type = 'danger') {
    const toastId = 'toast' + Date.now();
    const toastHTML = `
      <div id="${toastId}" class="toast align-items-center text-white bg-${type} border-0 mb-2" role="alert" aria-live="assertive" aria-atomic="true">
        <div class="d-flex">
          <div class="toast-body">${message}</div>
          <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
        </div>
      </div>
    `;
    const container = document.getElementById("toastContainer");
    container.insertAdjacentHTML("beforeend", toastHTML);
    const toast = new bootstrap.Toast(document.getElementById(toastId));
    toast.show();
  }

  // 🔹 File Validation & Upload
  form.addEventListener("submit", function(e) {
    e.preventDefault();

    const files = input.files;
    if (files.length < 2) {
      showToast("❌ Please upload at least two PDF files.");
      return;
    }

    for (let i = 0; i < files.length; i++) {
      if (!files[i].name.endsWith(".pdf")) {
        showToast("❌ Only PDF files allowed: " + files[i].name);
        return;
      }
      if (files[i].size > 1024 * 1024) {
        showToast("❌ File exceeds 1MB: " + files[i].name);
        return;
      }
    }

    // Show progress bar
    progressWrapper.style.display = "block";
    progressBar.style.width = "0%";

    const formData = new FormData();
    for (const file of files) {
      formData.append("pdfs", file);
    }

    const xhr = new XMLHttpRequest();
    xhr.open("POST", "/merge", true);
    xhr.responseType = "blob";

    xhr.upload.onprogress = (event) => {
      if (event.lengthComputable) {
        const percent = (event.loaded / event.total) * 100;
        progressBar.style.width = percent + "%";
      }
    };

    xhr.onload = function () {
      if (xhr.status === 200) {
        const blob = new Blob([xhr.response], { type: "application/pdf" });
        const link = document.createElement("a");
        link.href = URL.createObjectURL(blob);
        link.download = "merged_output.pdf";
        link.click();
        showToast("✅ PDF merged successfully!", "success");
      } else {
        showToast("❌ Merge failed. Please try again.");
      }
      progressWrapper.style.display = "none";
      progressBar.style.width = "0%";
    };

    xhr.onerror = () => {
      showToast("❌ Network error.");
      progressWrapper.style.display = "none";
    };

    xhr.send(formData);
  });
</script>

</body>
</html>
